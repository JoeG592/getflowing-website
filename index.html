<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Get Flowing, eh - AI-Powered Power Automate Flow Generation</title>
  <meta name="description" content="Turn your ideas into working automationâ€”instantly. No coding required. No technical knowledge needed. Proudly made in Edmonton, Alberta, Canada.">
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='15' fill='%2364748b'/><text x='50' y='70' font-size='50' font-weight='bold' text-anchor='middle' fill='white'>GF</text></svg>">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    const Loader2 = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
      </svg>
    );

    const CheckCircle = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
    );

    const AlertCircle = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
    );

    const Rocket = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
      </svg>
    );

    function GetFlowingEh() {
      const [prompt, setPrompt] = useState('');
      const [tenantUrl, setTenantUrl] = useState('');
      const [flowName, setFlowName] = useState('');
      const [loading, setLoading] = useState(false);
      const [stage, setStage] = useState('');
      const [generatedFlow, setGeneratedFlow] = useState(null);
      const [deploymentResult, setDeploymentResult] = useState(null);
      const [error, setError] = useState(null);
      const [logs, setLogs] = useState([]);

      const addLog = (message, type = 'info') => {
        setLogs(prev => [...prev, { timestamp: new Date().toISOString(), message, type }]);
      };

      const generateFlowWithBackend = async () => {
        addLog('ðŸ¤– Calling backend API to generate your flow...', 'info');
        
        const response = await fetch('/api/generate-flow', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: prompt, flowName: flowName })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || `API error: ${response.status}`);
        }

        const data = await response.json();
        if (!data.success || !data.flow) {
          throw new Error('No flow returned from API');
        }

        addLog('âœ… Flow generated successfully!', 'success');
        return data.flow;
      };

      const packageFlowAsSolution = (flowDefinition) => {
        addLog('ðŸ“¦ Packaging your flow...', 'info');
        const flowId = crypto.randomUUID();
        const solutionName = (flowName || 'AIGeneratedFlow').replace(/[^a-zA-Z0-9]/g, '');
        const solution = {
          workflows: [{ name: flowName || 'AI Generated Flow', definition: flowDefinition, type: 'cloud', id: flowId }],
          connections: [],
          connectionReferences: []
        };
        addLog('âœ… Solution package ready!', 'success');
        return { solution, flowId, solutionName };
      };

      const deployFlowToDataverse = async (packagedSolution) => {
        addLog('ðŸš€ Preparing deployment...', 'info');
        addLog('âš ï¸ Download JSON and run PowerShell script', 'warning');
        return {
          status: 'demo',
          message: 'Flow generated successfully! Download the JSON below and run the deployment script.',
          flowJson: JSON.stringify(packagedSolution.solution.workflows[0].definition, null, 2)
        };
      };

      const handleGenerate = async () => {
        if (!prompt.trim()) {
          setError('Please describe your automation flow');
          return;
        }

        setLoading(true);
        setError(null);
        setGeneratedFlow(null);
        setDeploymentResult(null);
        setLogs([]);

        try {
          setStage('Generating your flow...');
          const flowDefinition = await generateFlowWithBackend();
          setGeneratedFlow(flowDefinition);

          setStage('Packaging solution...');
          const packagedSolution = packageFlowAsSolution(flowDefinition);

          setStage('Preparing deployment...');
          const deployment = await deployFlowToDataverse(packagedSolution);
          setDeploymentResult(deployment);

          setStage('Complete!');
          addLog('ðŸŽŠ Your flow is ready!', 'success');
        } catch (err) {
          setError(err.message);
          addLog(`âŒ Error: ${err.message}`, 'error');
        } finally {
          setLoading(false);
        }
      };

      const downloadFlowJson = () => {
        if (!deploymentResult?.flowJson) return;
        const blob = new Blob([deploymentResult.flowJson], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${flowName || 'generated_flow'}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        addLog('ðŸ’¾ Flow JSON downloaded', 'success');
      };

      return (
        <div className="min-h-screen bg-red-50 p-8">
          <div className="max-w-5xl mx-auto">
            
            <div className="bg-white rounded-2xl p-8 mb-8 shadow-sm border border-gray-900">
              <div className="flex items-center justify-center gap-6 mb-6">
                <div className="w-20 h-20 bg-slate-600 rounded-xl flex items-center justify-center flex-shrink-0">
                  <span className="text-white text-4xl font-bold">GF</span>
                </div>
                <h1 className="text-5xl font-bold text-red-600">GET FLOWING, EH</h1>
              </div>
              <div className="text-center max-w-2xl mx-auto">
                <p className="text-xl text-gray-700 mb-3">TURN YOUR IDEAS INTO WORKING AUTOMATIONâ€”INSTANTLY.</p>
                <p className="text-base text-gray-600">No coding required. No technical knowledge needed. Just tell us what you want automated.</p>
              </div>
            </div>

            {loading && (
              <div className="bg-white rounded-2xl p-6 mb-8 shadow-sm border border-gray-900">
                <div className="flex items-center justify-between mb-4">
                  {[1,2,3,4,5].map((step, idx) => (
                    <React.Fragment key={step}>
                      {idx > 0 && <div className={`h-1 flex-1 mx-2 rounded ${stage.includes(['Generating','Packaging','Authenticating','Preparing','Complete'][idx-1]) ? 'bg-red-600' : 'bg-gray-200'}`}></div>}
                      <div className="flex flex-col items-center flex-1">
                        <div className={`w-12 h-12 rounded-full flex items-center justify-center font-semibold text-lg mb-2 ${
                          (step === 1 && (stage.includes('Generating') || stage.includes('Packaging') || stage.includes('Authenticating') || stage.includes('Preparing') || stage.includes('Complete'))) ||
                          (step === 2 && (stage.includes('Packaging') || stage.includes('Authenticating') || stage.includes('Preparing') || stage.includes('Complete'))) ||
                          (step === 3 && (stage.includes('Authenticating') || stage.includes('Preparing') || stage.includes('Complete'))) ||
                          (step === 4 && (stage.includes('Preparing') || stage.includes('Complete'))) ||
                          (step === 5 && stage.includes('Complete'))
                            ? (step === 5 && stage.includes('Complete') ? 'bg-green-600 text-white' : 'bg-red-600 text-white')
                            : 'bg-gray-200 text-gray-500'
                        }`}>
                          {step === 5 && stage.includes('Complete') ? 'âœ“' : step}
                        </div>
                        <span className="text-xs text-gray-600 text-center">{['Generate Flow','Package Solution','Authenticate','Prepare Deploy','Complete'][step-1]}</span>
                      </div>
                    </React.Fragment>
                  ))}
                </div>
                <div className="text-center"><p className="text-sm text-gray-600 font-medium">{stage}</p></div>
              </div>
            )}

            <div className="bg-white rounded-2xl p-8 mb-8 shadow-sm border border-gray-900">
              <div className="mb-6">
                <label className="block text-gray-800 mb-3 font-semibold text-lg">Describe what you want to automate</label>
                <textarea value={prompt} onChange={(e) => setPrompt(e.target.value)} placeholder="Example: When someone fills out my contact form, send me an email and add their info to my spreadsheet" className="w-full h-32 p-4 bg-red-50 border border-gray-900 rounded-xl text-gray-800 placeholder-gray-500 focus:outline-none focus:border-red-400 focus:ring-2 focus:ring-red-100 transition-all resize-none" disabled={loading} />
              </div>
              <div className="grid grid-cols-2 gap-6 mb-6">
                <div>
                  <label className="block text-gray-700 mb-2 text-sm font-medium">Flow Name (optional)</label>
                  <input type="text" value={flowName} onChange={(e) => setFlowName(e.target.value)} placeholder="My Automation" className="w-full p-3 bg-red-50 border border-gray-900 rounded-xl text-gray-800 placeholder-gray-500 focus:outline-none focus:border-red-400 focus:ring-2 focus:ring-red-100 transition-all" disabled={loading} />
                </div>
                <div>
                  <label className="block text-gray-700 mb-2 text-sm font-medium">Dataverse URL</label>
                  <input type="text" value={tenantUrl} onChange={(e) => setTenantUrl(e.target.value)} placeholder="https://yourorg.crm.dynamics.com" className="w-full p-3 bg-red-50 border border-gray-900 rounded-xl text-gray-800 placeholder-gray-500 focus:outline-none focus:border-red-400 focus:ring-2 focus:ring-red-100 transition-all" disabled={loading} />
                </div>
              </div>
              <button onClick={handleGenerate} disabled={loading} className="w-full bg-red-600 text-white font-semibold py-4 px-8 rounded-xl border border-gray-900 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-3 text-lg uppercase tracking-wide">
                {loading ? (<><Loader2 className="w-5 h-5 animate-spin" />{stage}</>) : (<><Rocket className="w-5 h-5" />Generate My Flow</>)}
              </button>
            </div>

            {error && (
              <div className="bg-red-100 rounded-xl p-4 mb-6 shadow-sm border border-gray-900">
                <div className="flex items-center gap-2 text-red-700">
                  <AlertCircle className="w-5 h-5" />
                  <span className="font-semibold">Error:</span>
                  <span>{error}</span>
                </div>
              </div>
            )}

            <div className="grid grid-cols-2 gap-6">
              {generatedFlow && (
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-900">
                  <div className="flex items-center gap-2 mb-4">
                    <CheckCircle className="w-6 h-6 text-red-600" />
                    <h3 className="text-xl font-semibold text-gray-800">Generated Flow</h3>
                  </div>
                  <pre className="bg-red-50 p-4 rounded-xl border border-gray-900 text-gray-800 text-xs overflow-auto max-h-96 font-mono">{JSON.stringify(generatedFlow, null, 2)}</pre>
                </div>
              )}

              {deploymentResult && (
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-900">
                  <div className="flex items-center gap-2 mb-4">
                    <Rocket className="w-6 h-6 text-red-600" />
                    <h3 className="text-xl font-semibold text-gray-800">Ready to Deploy</h3>
                  </div>
                  <div className="space-y-3">
                    <div className="bg-red-50 p-4 rounded-xl border border-gray-900">
                      <div className="text-gray-600 font-medium mb-1">Status</div>
                      <div className="text-gray-800 font-semibold uppercase">{deploymentResult.status}</div>
                    </div>
                    <div className="bg-red-50 p-4 rounded-xl border border-gray-900">
                      <div className="text-gray-600 font-medium mb-1">Next Steps</div>
                      <div className="text-gray-800 text-sm">{deploymentResult.message}</div>
                    </div>
                    {deploymentResult.flowJson && (
                      <button onClick={downloadFlowJson} className="w-full bg-red-600 text-white font-semibold py-3 px-4 rounded-xl border border-gray-900 hover:bg-red-700 transition-all flex items-center justify-center gap-2 shadow-md uppercase tracking-wide">
                        <span>ðŸ’¾</span>Download Flow JSON
                      </button>
                    )}
                  </div>
                </div>
              )}
            </div>

            {logs.length > 0 && (
              <div className="mt-6 bg-white rounded-2xl p-6 shadow-sm border border-gray-900">
                <h3 className="text-xl font-semibold text-gray-800 mb-4">Progress Log</h3>
                <div className="space-y-2 max-h-64 overflow-auto">
                  {logs.map((log, idx) => (
                    <div key={idx} className={`p-3 rounded-xl text-sm ${log.type === 'success' ? 'bg-green-50 text-green-800' : log.type === 'error' ? 'bg-red-100 text-red-800' : log.type === 'warning' ? 'bg-yellow-50 text-yellow-800' : 'bg-red-50 text-gray-700'}`}>
                      <span className="text-xs opacity-70 font-mono">{new Date(log.timestamp).toLocaleTimeString()}</span> - {log.message}
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="mt-8 text-center">
              <p className="text-gray-600 text-sm mb-1">Proudly made in Edmonton, Alberta, Canada ðŸ‡¨ðŸ‡¦</p>
              <p className="text-gray-500 text-xs">Powered by Claude AI â€¢ Built for Power Automate</p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<GetFlowingEh />, document.getElementById('root'));
  </script>
</body>
</html>
</body>
</html>
